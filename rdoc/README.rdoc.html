<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="custom.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README.rdoc</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
buby
</p>
<pre class="code">
  <span class='by identifier id'>by</span> <span class='Eric constant id'>Eric</span> <span class='Monti constant id'>Monti</span>
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/emonti.github.com/</span><span class='buby identifier id'>buby</span>
</pre>
<h2>DESCRIPTION:</h2>
<p>
Buby is a mashup of JRuby with the popular commercial web security testing
tool Burp Suite from PortSwigger. Burp is driven from and tied to JRuby
with a Java extension using the BurpExtender API. This extension aims to
add Ruby scriptability to Burp Suite with an interface comparable to the
Burp&#8217;s pure Java extension interface.
</p>
<h2>FEATURES/PROBLEMS:</h2>
<ul>
<li>Intercept and log proxied requests and responses via Burp into Ruby and
perform arbitrary processing on them.

</li>
<li>Modify requests and responses in-line using Ruby scripts.

</li>
<li>Pass requests and other information from JRuby to various sub-interfaces in
Burp

</li>
<li>Use the Burp framework for active and passive scanning using arbitrary
requests and responses.

</li>
<li>Use the Burp framework for making arbitrary HTTP requests

</li>
</ul>
<p>
Buby is implemented using an abstract Ruby event handler and interface
class. The Buby Ruby class is back-ended with a minimal BurpExtender class
implemented in Java. The java code is required to conform to nuances in the
Burp extension interface and while it&#8217;s in the pure Java runtime, it
acts as &#8216;glue&#8217; where deemed appropriate, but otherwise tries to
stay out of the way.
</p>
<p>
The java BurpExtender included with Buby is an implementation of
IBurpExtender which is the interface API supplied by PortSwigger for
writing extensions to Burp Suite. It mostly acts as a method proxy between
Ruby and Java, doing very little except event handler proxying between the
java and ruby runtimes with run-time type conversion as needed.
</p>
<h2>REQUIREMENTS:</h2>
<ul>
<li>JRuby - http://jruby.org Burp is Java based and the extension is developed
specifically around JRuby. The C version of ruby will not work.

</li>
<li>Burp (pro or free version): Buby is useless without a copy of Burp. Buby
has been tested successfully with Burp 1.2.x.

</li>
</ul>
<h2>BUILD/INSTALL:</h2>
<h3>Gem</h3>
<p>
You should be able to get up and running with just the gem and a copy of
Burp. I&#8217;ve packaged up a pre-built buby.jar file containing the
required classes minus ofcourse, Burp itself.
</p>
<pre class="code">
  <span class='lparen token'>(</span><span class='sudo identifier id'>sudo</span><span class='rparen token'>)</span><span class='question op'>?</span> <span class='jruby identifier id'>jruby</span> <span class='minus op'>-</span><span class='S constant id'>S</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='buby identifier id'>buby</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='source identifier id'>source</span><span class='assign token'>=</span><span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gemcutter.org
</span></pre>
<ul>
<li>IMPORTANT: The buby gem doesn&#8217;t include a copy of Burp! See manual
step #5 below. For best results, you&#8217;ll still want to make your
burp.jar available in the ruby runtime library path.

</li>
</ul>
<h3>Manual</h3>
<p>
Here are manual instructions if you want or need to build things yourself:
</p>
<h4>Step 1. Download buby from github</h4>
<pre class="code">
  <span class='git identifier id'>git</span> <span class='clone identifier id'>clone</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/e</span><span class='monti identifier id'>monti</span><span class='div op'>/</span><span class='buby identifier id'>buby</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<h4>Step 2. Compile BurpExtender.java. Include jruby.jar in the classpath:</h4>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='buby identifier id'>buby</span><span class='div op'>/</span><span class='java identifier id'>java</span><span class='div op'>/</span><span class='src identifier id'>src</span>
  <span class='javac identifier id'>javac</span> <span class='minus op'>-</span><span class='classpath identifier id'>classpath</span> <span class='lparen token'>(</span><span class='dot3 op'>...</span><span class='regexp val'>/jruby/</span><span class='root identifier id'>root</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='jruby identifier id'>jruby</span><span class='dot token'>.</span><span class='jar identifier id'>jar</span><span class='symbol val'>:.</span> <span class='BurpExtender constant id'>BurpExtender</span><span class='dot token'>.</span><span class='java identifier id'>java</span>
</pre>
<h4>Step 3. Create a new java/buby.jar</h4>
<pre class="code">
  <span class='jar identifier id'>jar</span> <span class='cvf identifier id'>cvf</span> <span class='dot2 op'>..</span><span class='regexp val'>/buby.jar .
</span></pre>
<h4>Step 4. Build a local gem and install it</h4>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='dot2 op'>..</span><span class='regexp val'>/../</span>
  <span class='jruby identifier id'>jruby</span> <span class='minus op'>-</span><span class='S constant id'>S</span> <span class='gem identifier id'>gem</span> <span class='build identifier id'>build</span> <span class='buby identifier id'>buby</span><span class='dot token'>.</span><span class='gemspec identifier id'>gemspec</span>
  <span class='jruby identifier id'>jruby</span> <span class='minus op'>-</span><span class='S constant id'>S</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='local identifier id'>local</span> <span class='buby identifier id'>buby</span><span class='minus op'>-</span><span class='mult op'>*</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span>
</pre>
<h4>Step 5.</h4>
<p>
The last part is a bit tricky. Burp Suite itself is obviously not included
with buby. You&#8217;ll want to somehow put your &#8216;burp.jar&#8217; in
a place where it is visible in the JRuby RUBY-LIB paths. There are a few
other ways of pulling in Burp during runtime, but this method probably
involves the least amount of hassle in the long run.
</p>
<p>
JRuby usually gives you a &#8216;java&#8217; lib directory for this kind of
thing. Here&#8217;s a quick way to see jruby&#8217;s runtime lib-path:
</p>
<pre class="code">
  <span class='jruby identifier id'>jruby</span> <span class='minus op'>-</span><span class='e identifier id'>e</span> <span class='string val'>'puts $:'</span>
</pre>
<p>
There is usually a &#8217;&#8230;/jruby/lib/1.8/java&#8217; directory
reference in there, though the actual directory may need to be created.
</p>
<p>
Here&#8217;s how I do it. I have my jruby installation under my home
directory. Your configuration details can be substituted below.
</p>
<pre class="code">
  <span class='mkdir identifier id'>mkdir</span> <span class='bitnot op'>~</span><span class='regexp val'>/jruby-1.1.5/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='ruby identifier id'>ruby</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='div op'>/</span><span class='java identifier id'>java</span>
  <span class='ln identifier id'>ln</span> <span class='minus op'>-</span><span class='s identifier id'>s</span> <span class='bitnot op'>~</span><span class='regexp val'>/tools/</span><span class='burp identifier id'>burp</span><span class='dot token'>.</span><span class='jar identifier id'>jar</span> <span class='bitnot op'>~</span><span class='regexp val'>/jruby-1.1.5/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='ruby identifier id'>ruby</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='div op'>/</span><span class='java identifier id'>java</span><span class='div op'>/</span><span class='burp identifier id'>burp</span><span class='dot token'>.</span><span class='jar identifier id'>jar</span>
</pre>
<p>
Now everything should be ready to go. Try at least the first few parts of
the test below to confirm everything is set up.
</p>
<h2>TEST AND USAGE EXAMPLE:</h2>
<p>
The gem includes a command-line executable called &#8216;buby&#8217;. You
can use this to test your Buby set-up and try out a few features.
</p>
<pre class="code">
  $ <span class='buby identifier id'>buby</span> <span class='minus op'>-</span><span class='h identifier id'>h</span>
  <span class='Usage constant id'>Usage</span><span class='colon op'>:</span> <span class='buby identifier id'>buby</span> <span class='lbrack token'>[</span><span class='options identifier id'>options</span><span class='rbrack token'>]</span>
      <span class='minus op'>-</span><span class='i identifier id'>i</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='interactive identifier id'>interactive</span>          <span class='Start constant id'>Start</span> <span class='IRB constant id'>IRB</span>
      <span class='minus op'>-</span><span class='d identifier id'>d</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='debug identifier id'>debug</span>                <span class='Debug constant id'>Debug</span> <span class='info identifier id'>info</span>
      <span class='minus op'>-</span><span class='B constant id'>B</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='load identifier id'>load</span><span class='minus op'>-</span><span class='burp identifier id'>burp</span><span class='assign token'>=</span><span class='PATH constant id'>PATH</span>       <span class='Load constant id'>Load</span> <span class='Burp constant id'>Burp</span> <span class='Jar constant id'>Jar</span> <span class='from identifier id'>from</span> <span class='PATH constant id'>PATH</span>
      <span class='minus op'>-</span><span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='state identifier id'>state</span><span class='assign token'>=</span><span class='FILE constant id'>FILE</span>           <span class='Restore constant id'>Restore</span> <span class='burp identifier id'>burp</span> <span class='state identifier id'>state</span> <span class='file identifier id'>file</span> <span class='on identifier id'>on</span> <span class='startup identifier id'>startup</span>
      <span class='minus op'>-</span><span class='r identifier id'>r</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='require identifier id'>require</span><span class='assign token'>=</span><span class='LIB constant id'>LIB</span>          <span class='load identifier id'>load</span> <span class='a identifier id'>a</span> <span class='ruby identifier id'>ruby</span> <span class='lib identifier id'>lib</span> <span class='lparen token'>(</span><span class='or or kw'>or</span> <span class='jar identifier id'>jar</span><span class='rparen token'>)</span> <span class='after identifier id'>after</span> <span class='Burp constant id'>Burp</span> <span class='loads identifier id'>loads</span>
      <span class='minus op'>-</span><span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='extend identifier id'>extend</span><span class='assign token'>=</span><span class='MOD constant id'>MOD</span>           <span class='Extend constant id'>Extend</span> <span class='Buby constant id'>Buby</span> <span class='with identifier id'>with</span> <span class='a identifier id'>a</span> <span class='module module kw'>module</span> <span class='lparen token'>(</span><span class='loaded identifier id'>loaded</span> <span class='via identifier id'>via</span> <span class='minus op'>-</span><span class='r? fid id'>r?</span><span class='rparen token'>)</span>
      <span class='minus op'>-</span><span class='h identifier id'>h</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='help identifier id'>help</span>                 <span class='Show constant id'>Show</span> <span class='this identifier id'>this</span> <span class='help identifier id'>help</span> <span class='message identifier id'>message</span>

  $ <span class='buby identifier id'>buby</span> <span class='minus op'>-</span><span class='i identifier id'>i</span> <span class='minus op'>-</span><span class='d identifier id'>d</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:got_extender</span><span class='comma token'>,</span> <span class='comment val'>#&lt;Java::Default::BurpExtender:0x80 ...&gt;]</span>
  <span class='Global constant id'>Global</span> <span class='$burp gvar id'>$burp</span> <span class='is identifier id'>is</span> <span class='set identifier id'>set</span> <span class='to identifier id'>to</span> <span class='comment val'>#&lt;Buby:0x78de07 @burp_callbacks=#&lt;#&lt;Class:...&gt;</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:got_callbacks</span><span class='comma token'>,</span> <span class='comment val'>#&lt;#&lt;Class:01x38ba04&gt;:0x90 ...&gt;]</span>
  <span class='irb identifier id'>irb</span><span class='lparen token'>(</span><span class='main identifier id'>main</span><span class='rparen token'>)</span><span class='symbol val'>:001</span><span class='symbol val'>:0</span><span class='gt op'>&gt;</span>
</pre>
<p>
Once Burp is running, click on the alerts tab.
</p>
<p>
You should see now something like the following in alerts:
</p>
<pre class="code">
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='method identifier id'>method</span> <span class='BurpExtender constant id'>BurpExtender</span><span class='dot token'>.</span><span class='processProxyMessage identifier id'>processProxyMessage</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='found identifier id'>found</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='method identifier id'>method</span> <span class='BurpExtender constant id'>BurpExtender</span><span class='dot token'>.</span><span class='registerExtenderCallbacks identifier id'>registerExtenderCallbacks</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='found identifier id'>found</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='method identifier id'>method</span> <span class='BurpExtender constant id'>BurpExtender</span><span class='dot token'>.</span><span class='setCommandLineArgs identifier id'>setCommandLineArgs</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='found identifier id'>found</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='method identifier id'>method</span> <span class='BurpExtender constant id'>BurpExtender</span><span class='dot token'>.</span><span class='applicationClosing identifier id'>applicationClosing</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='found identifier id'>found</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='proxy identifier id'>proxy</span>   <span class='proxy identifier id'>proxy</span> <span class='service identifier id'>service</span> <span class='started identifier id'>started</span> <span class='on identifier id'>on</span> <span class='port identifier id'>port</span> <span class='integer val'>8080</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='lbrack token'>[</span><span class='BurpExtender constant id'>BurpExtender</span><span class='rbrack token'>]</span> <span class='registering identifier id'>registering</span> <span class='JRuby constant id'>JRuby</span> <span class='handler identifier id'>handler</span> <span class='callbacks identifier id'>callbacks</span>
  <span class='integer val'>2</span><span class='symbol val'>:46</span><span class='symbol val'>:01</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='lbrack token'>[</span><span class='JRuby constant id'>JRuby</span><span class='colon2 op'>::</span><span class='Buby constant id'>Buby</span><span class='rbrack token'>]</span> <span class='registered identifier id'>registered</span> <span class='callback identifier id'>callback</span>
</pre>
<p>
Here are some simple test examples using Buby through the IRB shell:
</p>
<p>
To confirm you are connected back to Burp in IRB, you can try writing to
the alerts panel with something like the following:
</p>
<pre class="code">
  <span class='$burp gvar id'>$burp</span><span class='dot token'>.</span><span class='alert identifier id'>alert</span><span class='lparen token'>(</span><span class='string val'>&quot;hello Burp!&quot;</span><span class='rparen token'>)</span>
</pre>
<p>
Which should produce a new alert:
</p>
<pre class="code">
  <span class='integer val'>2</span><span class='symbol val'>:47</span><span class='symbol val'>:00</span> <span class='PM constant id'>PM</span>  <span class='suite identifier id'>suite</span>   <span class='hello identifier id'>hello</span> <span class='Burp! constant id'>Burp!</span>
</pre>
<p>
Next, try making an HTTP request through the proxy. We&#8217;ll use
Net:HTTP right in IRB for illustration purposes. However, you can just as
easily perform this test through a browser configured to use Burp as its
proxy.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'net/http'</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='colon2 op'>::</span><span class='Proxy constant id'>Proxy</span><span class='lparen token'>(</span><span class='string val'>&quot;localhost&quot;</span><span class='comma token'>,</span> <span class='integer val'>8080</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='start identifier id'>start</span><span class='lparen token'>(</span><span class='string val'>&quot;www.example.com&quot;</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>
</pre>
<p>
With $DEBUG = true, you should see the debugging output from Ruby as the
proxy passes your request back to your HTTP client/browser.
</p>
<p>
It will look something like the following in IRB:
</p>
<pre class="code">
  <span class='rshft op'>&gt;&gt;</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:got_proxy_request</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:msg_ref</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:is_req</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:rhost</span><span class='comma token'>,</span> <span class='string val'>&quot;www.example.com&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:rport</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:is_https</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:http_meth</span><span class='comma token'>,</span> <span class='string val'>&quot;GET&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:resourceType</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:req_content_type</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='comma token'>,</span> <span class='string val'>&quot;GET / HTTP/1.1\r\nAccept:...&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
</pre>
<p>
You may also see the response right away depending on your intercept
settings in Burp. Back the in Burp proxy&#8217;s intercept window, turn off
interception if it hasn&#8217;t already been disabled. Now you should
definitely see the response in IRB as it passes back through the Burp
proxy.
</p>
<pre class="code">
  <span class='lbrack token'>[</span><span class='symbol val'>:got_proxy_response</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:msg_ref</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:is_req</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:rhost</span><span class='comma token'>,</span> <span class='string val'>&quot;www.example.com&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:rport</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:is_https</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:http_meth</span><span class='comma token'>,</span> <span class='string val'>&quot;GET&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:resourceType</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='string val'>&quot;200&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:req_content_type</span><span class='comma token'>,</span> <span class='string val'>&quot;text/html; charset=utf-8&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='comma token'>,</span> <span class='string val'>&quot;HTTP/1.1 200 OK\r\n...&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Net::HTTPOK 200 OK readbody=true&gt;</span>
  <span class='rshft op'>&gt;&gt;</span>
</pre>
<p>
Note also, the Net::HTTP request should have returned the same result as
shown in the proxy.
</p>
<p>
Now, lets try something mildly interesting with the proxy. This contrived
example will implement a proxy request manipulator to do HTTP request verb
tampering on every GET request that goes through the proxy.
</p>
<pre class="code">
  <span class='comment val'># Note: I'm using 'instance_eval' here only to stay with the flow of the</span>
  <span class='comment val'># existing IRB session. Normally, you'd probably want to implement this as</span>
  <span class='comment val'># an override in your Buby-derived class.</span>

  <span class='$burp gvar id'>$burp</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span> <span class='do do kw'>do</span>

    <span class='def def kw'>def</span> <span class='evt_proxy_message identifier id'>evt_proxy_message</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='param identifier id'>param</span><span class='rparen token'>)</span>
      <span class='msg_ref identifier id'>msg_ref</span><span class='comma token'>,</span> <span class='is_req identifier id'>is_req</span><span class='comma token'>,</span> <span class='rhost identifier id'>rhost</span><span class='comma token'>,</span> <span class='rport identifier id'>rport</span><span class='comma token'>,</span> <span class='is_https identifier id'>is_https</span><span class='comma token'>,</span> <span class='http_meth identifier id'>http_meth</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='comma token'>,</span> <span class='resourceType identifier id'>resourceType</span><span class='comma token'>,</span>
      <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='req_content_type identifier id'>req_content_type</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='action identifier id'>action</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span>

      <span class='if if kw'>if</span> <span class='is_req identifier id'>is_req</span> <span class='and and kw'>and</span> <span class='http_meth identifier id'>http_meth</span><span class='eq op'>==</span><span class='string val'>&quot;GET&quot;</span>
        <span class='comment val'># Change the HTTP request verb to something silly</span>
        <span class='message identifier id'>message</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;PET&quot;</span>

        <span class='comment val'># Forcibly disable interception in the Burp UI</span>
        <span class='action identifier id'>action</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Buby constant id'>Buby</span><span class='colon2 op'>::</span><span class='ACTION_DONT_INTERCEPT constant id'>ACTION_DONT_INTERCEPT</span>

        <span class='comment val'># Return a new instance and still get $DEBUG info</span>
        <span class='return return kw'>return</span> <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='param identifier id'>param</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># Just get $DEBUG info for all other requests</span>
        <span class='return return kw'>return</span> <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='param identifier id'>param</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>

  <span class='comment val'># Now, make another request using the Net::HTTP client</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='string val'>&quot;/&quot;</span><span class='rparen token'>)</span>
</pre>
<p>
This should produce a request that looks like the following in IRB:
</p>
<pre class="code">
  <span class='lbrack token'>[</span><span class='symbol val'>:got_proxy_request</span><span class='comma token'>,</span>
   <span class='dot3 op'>...</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='comma token'>,</span>
    <span class='string val'>&quot;PET / HTTP/1.1\r\nAccept: */*\r\nUser-Agent: Ruby...&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
</pre>
<p>
And, assuming &#8216;www.example.com&#8217; checks for valid request verbs,
you should see something like the following response:
</p>
<pre class="code">
  <span class='lbrack token'>[</span><span class='symbol val'>:got_proxy_response</span><span class='comma token'>,</span>
   <span class='dot3 op'>...</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:http_meth</span><span class='comma token'>,</span> <span class='string val'>&quot;PET&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:url</span><span class='comma token'>,</span> <span class='string val'>&quot;/&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:resourceType</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='string val'>&quot;400&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='dot3 op'>...</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='comma token'>,</span>
    <span class='string val'>&quot;HTTP/1.1 400 Bad Request\r\nContent-Type:...&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
   <span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Net::HTTPBadRequest 400 Bad Request readbody=true&gt;</span>
</pre>
<h2>CREDIT:</h2>
<ul>
<li>Burp and Burp Suite are trademarks of PortSwigger(ltd) Copyright 2008
PortSwigger Ltd. All rights reserved. See http://portswigger.net for
license terms.

</li>
<li>This ruby library and the accompanying BurpExtender.java implementation are
written by Eric Monti @ Matasano Security. Matasano Security claims no
professional or legal affiliation with PortSwigger LTD.

<p>
However, the author would like to express his personal and professional
respect and admiration to Burp&#8217;s authors and appreciation to
PortSwigger for the availability of the IBurpExtender extension API.
</p>
<p>
The availability of this interface goes a long way to helping make Burp
Suite a truly first-class application.
</p>
</li>
</ul>
<h2>LICENSE:</h2>
<ul>
<li>Burp and Burp Suite are trademarks of PortSwigger Ltd. Copyright 2008
PortSwigger Ltd. All rights reserved. See http://portswigger.net for
license terms.

</li>
<li>The Buby Ruby library and its accompanying BurpExtender implementation are
both freely available under the terms of the MIT public license:

</li>
</ul>
<p>
(The MIT License)
</p>
<p>
Copyright (C) 2009 Eric Monti, Matasano Security
</p>
<p>
Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&#8216;Software&#8217;), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge,
publish, distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to the
following conditions:
</p>
<p>
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
</p>
<p>
THE SOFTWARE IS PROVIDED &#8216;AS IS&#8217;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.
</p>

      </div>
    </div>
    <div id="yard_info">
  Generated on Tuesday, December 29 2009 at 05:15:38 PM by 
  <abbr class="yard" title="Yay! A Ruby Documentation Tool"><a href="http://yard.soen.ca">YARD</a></abbr> 
  0.2.3.5 (ruby-1.8.6).
</div>

  </body>
</html>